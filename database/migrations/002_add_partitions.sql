-- 修复分区时间戳错误
-- 如果您的数据库使用了错误的2024时间戳，运行此脚本进行修复
-- 注意：这会删除并重建所有2025分区，请确保先备份数据！

-- 删除所有旧分区（如果存在）
DROP TABLE IF EXISTS dex_transactions_2025_01 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_02 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_03 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_04 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_05 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_06 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_07 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_08 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_09 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_10 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_11 CASCADE;
DROP TABLE IF EXISTS dex_transactions_2025_12 CASCADE;

-- 使用正确的2025年Unix时间戳重建分区

-- 2025-01
CREATE TABLE dex_transactions_2025_01 PARTITION OF dex_transactions
    FOR VALUES FROM (1735689600) TO (1738368000); -- 2025-01-01 to 2025-02-01

-- 2025-02
CREATE TABLE dex_transactions_2025_02 PARTITION OF dex_transactions
    FOR VALUES FROM (1738368000) TO (1740787200); -- 2025-02-01 to 2025-03-01

-- 2025-03
CREATE TABLE dex_transactions_2025_03 PARTITION OF dex_transactions
    FOR VALUES FROM (1740787200) TO (1743465600); -- 2025-03-01 to 2025-04-01

-- 2025-04
CREATE TABLE dex_transactions_2025_04 PARTITION OF dex_transactions
    FOR VALUES FROM (1743465600) TO (1746057600); -- 2025-04-01 to 2025-05-01

-- 2025-05
CREATE TABLE dex_transactions_2025_05 PARTITION OF dex_transactions
    FOR VALUES FROM (1746057600) TO (1748736000); -- 2025-05-01 to 2025-06-01

-- 2025-06
CREATE TABLE dex_transactions_2025_06 PARTITION OF dex_transactions
    FOR VALUES FROM (1748736000) TO (1751328000); -- 2025-06-01 to 2025-07-01

-- 2025-07
CREATE TABLE dex_transactions_2025_07 PARTITION OF dex_transactions
    FOR VALUES FROM (1751328000) TO (1754006400); -- 2025-07-01 to 2025-08-01

-- 2025-08
CREATE TABLE dex_transactions_2025_08 PARTITION OF dex_transactions
    FOR VALUES FROM (1754006400) TO (1756684800); -- 2025-08-01 to 2025-09-01

-- 2025-09
CREATE TABLE dex_transactions_2025_09 PARTITION OF dex_transactions
    FOR VALUES FROM (1756684800) TO (1759276800); -- 2025-09-01 to 2025-10-01

-- 2025-10
CREATE TABLE dex_transactions_2025_10 PARTITION OF dex_transactions
    FOR VALUES FROM (1759276800) TO (1761955200); -- 2025-10-01 to 2025-11-01

-- 2025-11
CREATE TABLE dex_transactions_2025_11 PARTITION OF dex_transactions
    FOR VALUES FROM (1761955200) TO (1764547200); -- 2025-11-01 to 2025-12-01

-- 2025-12
CREATE TABLE dex_transactions_2025_12 PARTITION OF dex_transactions
    FOR VALUES FROM (1764547200) TO (1767225600); -- 2025-12-01 to 2026-01-01

-- 完成
SELECT 'Partitions fixed successfully with correct 2025 timestamps!' AS status;
